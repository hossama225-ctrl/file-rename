
import os
import tkinter as tk
from tkinter import filedialog, messagebox, scrolledtext
import PyPDF2

# Function to extract Ref value from PDF text
def extract_ref_from_pdf(pdf_path):
    try:
        with open(pdf_path, 'rb') as file:
            reader = PyPDF2.PdfReader(file)
            text = ""
            for page in reader.pages:
                text += page.extract_text() + "\n"
            # Search for 'Ref.:' in the text
            for line in text.split("\n"):
                if "Ref.:" in line:
                    # Extract value after 'Ref.:'
                    ref_value = line.split("Ref.:")[-1].strip()
                    return ref_value if ref_value else None
    except Exception:
        return None
    return None

# Function to rename files in the selected folder
def rename_files(folder_path, suffix_text, log_widget):
    renamed_files = []
    for filename in os.listdir(folder_path):
        if filename.lower().endswith(".pdf"):
            file_path = os.path.join(folder_path, filename)
            ref_value = extract_ref_from_pdf(file_path)
            if ref_value:
                new_name = f"{ref_value} ({suffix_text}).pdf"
                new_path = os.path.join(folder_path, new_name)
                os.rename(file_path, new_path)
                renamed_files.append(new_name)
                log_widget.insert(tk.END, f"Renamed: {filename} -> {new_name}\n")
            else:
                log_widget.insert(tk.END, f"Skipped (No Ref found): {filename}\n")
    messagebox.showinfo("Completed", f"Renamed {len(renamed_files)} files.")

# GUI setup
root = tk.Tk()
root.title("PDF Ref Renamer")
root.geometry("600x450")

folder_path = tk.StringVar()
suffix_text = tk.StringVar(value="Replied")

def browse_folder():
    path = filedialog.askdirectory()
    if path:
        folder_path.set(path)

# Widgets
tk.Label(root, text="Select Folder with PDF Files:").pack(pady=10)
tk.Entry(root, textvariable=folder_path, width=50).pack(pady=5)
tk.Button(root, text="Browse", command=browse_folder).pack(pady=5)

tk.Label(root, text="Enter suffix text (default: Replied):").pack(pady=10)
tk.Entry(root, textvariable=suffix_text, width=30).pack(pady=5)

tk.Button(root, text="Rename Files", command=lambda: rename_files(folder_path.get(), suffix_text.get(), log_area)).pack(pady=10)

log_area = scrolledtext.ScrolledText(root, width=70, height=15)
log_area.pack(pady=10)

root.mainloop()

